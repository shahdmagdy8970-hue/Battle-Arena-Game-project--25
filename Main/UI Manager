package com.example.battlearena;

import com.example.battlearena.controllers.GameController;
import com.example.battlearena.models.FighterType;
import javafx.application.Application;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
import javafx.stage.Stage;

public class Main extends Application {
    private static final int CANVAS_WIDTH = 800;
    private static final int CANVAS_HEIGHT = 600;

    private GameController gameController;
    private ProgressBar health1Bar, health2Bar;
    private Label health1Label, health2Label, weapon1Label, weapon2Label;

    @Override
    public void start(Stage primaryStage) {
        primaryStage.setTitle("Battle Arena Game - Team Project");
        primaryStage.setScene(createSelectionScene(primaryStage));
        primaryStage.show();
    }

    private Scene createSelectionScene(Stage stage) {
        VBox root = new VBox(20);
        root.setPadding(new Insets(30));
        root.setAlignment(Pos.CENTER);
        root.setStyle("-fx-background-image: url('file:///C:/Users/alaa/Downloads/WhatsApp%20Image%202025-12-18%20at%2023.58.43_7f5e23cc.jpg'); " +
                "-fx-background-size: cover; " +
                "-fx-background-position: center;");

        Label title = new Label("âš” BATTLE ARENA âš”");
        title.setFont(Font.font("Arial", FontWeight.BOLD, 40));
        title.setTextFill(Color.GOLD);
        title.setStyle("-fx-effect: dropshadow(gaussian, black, 15, 0.8, 0, 2);");

        Label teamLabel = new Label("Team Members Battle");
        teamLabel.setFont(Font.font("Arial", FontWeight.BOLD, 18));
        teamLabel.setTextFill(Color.WHITE);
        teamLabel.setStyle("-fx-effect: dropshadow(gaussian, black, 10, 0.7, 0, 1);");

        HBox playersBox = new HBox(30);
        playersBox.setAlignment(Pos.CENTER);

        VBox player1Box = createPlayerSelectionBox("Player 1", FighterType.MARIAM,
                "W/A/S/D to move\nF to shoot\n1/2/3/4 to switch weapon");
        ComboBox<FighterType> player1Choice = (ComboBox<FighterType>) player1Box.getChildren().get(1);

        VBox player2Box = createPlayerSelectionBox("Player 2", FighterType.ALAA,
                "Arrow Keys to move\nL to shoot\n7/8/9/0 to switch weapon");
        ComboBox<FighterType> player2Choice = (ComboBox<FighterType>) player2Box.getChildren().get(1);

        playersBox.getChildren().addAll(player1Box, player2Box);

        CheckBox fullMovementCheck = new CheckBox("Enable Full Movement & Rotation");
        fullMovementCheck.setTextFill(Color.YELLOW);
        fullMovementCheck.setFont(Font.font("Arial", FontWeight.BOLD, 14));
        fullMovementCheck.setStyle("-fx-effect: dropshadow(gaussian, black, 8, 0.6, 0, 1);");

        Label weaponInfo = new Label("âœ¨ 4 Weapons Available âœ¨");
        weaponInfo.setTextFill(Color.LIGHTGREEN);
        weaponInfo.setFont(Font.font("Arial", FontWeight.BOLD, 12));
        weaponInfo.setStyle("-fx-effect: dropshadow(gaussian, black, 8, 0.6, 0, 1);");

        Label weaponDetails = new Label("Weapons: 1=Pistol, 2=Cannon, 3=Magic Staff, 4=Bow");
        weaponDetails.setTextFill(Color.WHITE);
        weaponDetails.setFont(Font.font("Arial", 11));
        weaponDetails.setStyle("-fx-effect: dropshadow(gaussian, black, 8, 0.6, 0, 1);");

        Button startButton = new Button("START GAME");
        startButton.setStyle("-fx-background-color: #27ae60; -fx-text-fill: white; " +
                "-fx-font-size: 18px; -fx-font-weight: bold; -fx-padding: 15 40; " +
                "-fx-effect: dropshadow(gaussian, black, 10, 0.5, 0, 2);");
        startButton.setOnAction(e -> {
            boolean fullMovement = fullMovementCheck.isSelected();
            stage.setScene(createGameScene(stage, player1Choice.getValue(),
                    player2Choice.getValue(), fullMovement));
        });

        root.getChildren().addAll(title, teamLabel, playersBox, fullMovementCheck,
                weaponInfo, weaponDetails, startButton);
        return new Scene(root, 900, 750);
    }

    private VBox createPlayerSelectionBox(String playerName, FighterType defaultChoice, String controls) {
        VBox box = new VBox(10);
        box.setPadding(new Insets(20));
        box.setStyle("-fx-background-color: rgba(0,0,0,0.85); -fx-background-radius: 10; " +
                "-fx-effect: dropshadow(gaussian, black, 15, 0.5, 0, 0);");

        Label label = new Label(playerName);
        label.setFont(Font.font("Arial", FontWeight.BOLD, 20));
        label.setTextFill(Color.WHITE);

        ComboBox<FighterType> choice = new ComboBox<>();
        choice.getItems().addAll(FighterType.values());
        choice.setValue(defaultChoice);
        choice.setStyle("-fx-font-size: 14px;");

        Label controlsLabel = new Label(controls);
        controlsLabel.setTextFill(Color.LIGHTGRAY);
        controlsLabel.setFont(Font.font(12));

        box.getChildren().addAll(label, choice, controlsLabel);
        return box;
    }

    private void showWinner(Stage stage, String winner) {
        StackPane root = new StackPane();
        root.setStyle("-fx-background-image: url('file:///C:/Users/alaa/Downloads/WhatsApp%20Image%202025-12-18%20at%2023.58.43_7f5e23cc.jpg'); " +
                "-fx-background-size: cover; " +
                "-fx-background-position: center;");

        VBox winnerBox = new VBox(30);
        winnerBox.setAlignment(Pos.CENTER);
        winnerBox.setPadding(new Insets(50));
        winnerBox.setPrefWidth(500);
        winnerBox.setPrefHeight(500);
        winnerBox.setMaxWidth(500);
        winnerBox.setMaxHeight(500);
        winnerBox.setStyle("-fx-background-color: rgba(0, 0, 0, 0.85); " +
                "-fx-background-radius: 15; " +
                "-fx-border-color: gold; " +
                "-fx-border-width: 3; " +
                "-fx-border-radius: 15; " +
                "-fx-effect: dropshadow(gaussian, gold, 25, 0.7, 0, 0);");

        Label winnerLabel = new Label("ðŸ† " + winner + " Wins! ðŸ†");
        winnerLabel.setFont(Font.font("Arial", FontWeight.BOLD, 42));
        winnerLabel.setTextFill(Color.GOLD);
        winnerLabel.setWrapText(true);
        winnerLabel.setMaxWidth(400);
        winnerLabel.setStyle("-fx-effect: dropshadow(gaussian, black, 15, 0.8, 0, 2); " +
                "-fx-text-alignment: center;");

        Button playAgain = new Button("Play Again");
        playAgain.setStyle("-fx-background-color: #27ae60; -fx-text-fill: white; " +
                "-fx-font-size: 18px; -fx-font-weight: bold; -fx-padding: 15 40; " +
                "-fx-background-radius: 8; " +
                "-fx-effect: dropshadow(gaussian, black, 10, 0.5, 0, 2);");
        playAgain.setOnAction(e -> {
            if (gameController != null) {
                gameController.stopGameLoop();
            }
            stage.setScene(createSelectionScene(stage));
        });

        winnerBox.getChildren().addAll(winnerLabel, playAgain);
        root.getChildren().add(winnerBox);

        stage.setScene(new Scene(root, 900, 700));
    }

    public static void main(String[] args) {
        launch(args);
    }
}
